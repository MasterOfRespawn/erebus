PROTO worldTile [
      field SFInt32 xPos 0
      field SFInt32 zPos 0
      field SFBool floor FALSE
      field SFBool topWall FALSE
      field SFBool rightWall FALSE
      field SFBool bottomWall FALSE
      field SFBool leftWall FALSE
      field SFBool topLeftCorner FALSE
      field SFBool bottomLeftCorner FALSE
      field SFBool bottomRightCorner FALSE
      field SFBool topRightCorner FALSE
	  field SFBool topExternal FALSE
	  field SFBool rightExternal FALSE
	  field SFBool bottomExternal FALSE
	  field SFBool leftExternal FALSE
	  field SFString notch ""
	  field SFFloat notchRotation 0.0
	  field SFBool start FALSE
	  field SFBool trap FALSE
	  field SFBool checkpoint FALSE
	  field SFBool swamp FALSE
	  field SFFloat width 0.0
	  field SFFloat height 0.0
	  field SFString id ""
	  field SFFloat xScale 1.0
	  field SFFloat zScale 1.0
	  field SFFloat yScale 1.0
		field MFInt32 halfWallOut [0, 0, 0, 0]
		field MFInt32 halfWallIn [0, 0, 0, 0]
		field MFInt32 curveWall [0, 0, 0, 0]
		field SFColor tileColor 0.635 0.635 0.635
]
{
      DEF TILE Solid {

	  %{
	  scaleX = fields.xScale.value
	  scaleY = fields.yScale.value
	  scaleZ = fields.zScale.value
	  xStart = -(fields.width.value * (0.3 * scaleX) / 2.0)
	  zStart = -(fields.height.value * (0.3 * scaleZ) / 2.0)
	  x = fields.xPos.value * (0.3 * scaleX) + xStart
	  z = fields.zPos.value * (0.3 * scaleZ) + zStart
	  }%

	  translation %{=x}% 0 %{=z}%
	  scale %{=scaleX}% %{=scaleY}% %{=scaleZ}%

      children[
		  DEF TILE_SHAPES_GROUP Group {
			  children [

				%{if fields.floor.value == true then}%
					DEF FLOOR Transform {
						translation 0 -0.085 0
						children [
							Shape {
								appearance Appearance {
									material Material {
										diffuseColor IS tileColor
									}
								}
								geometry DEF FLOORBOX Box {
									size 0.3 0.02 0.3
								}
							}
						]
					}
				%{end}%
				%{if fields.topWall.value == true or fields.halfWallOut.value[1] > 0 then}%
					DEF BACKWALL Transform {
						%{if fields.halfWallOut.value[1] == 1 then}%
							translation -0.071875 0 -0.14375
						%{elseif fields.halfWallOut.value[1] == 2 then}%
							translation 0.071875 0 -0.14375
						%{else}%
							translation 0 0 -0.14375
						%{end}%
						children [
							Shape {
								appearance Appearance {
									material Material {
										diffuseColor 0.2 0.47 0.52
									}
								}
								geometry DEF BACKWALLBOX Box {
									%{if fields.halfWallOut.value[1] > 0 then}%
										size 0.1375 0.15 0.0125
									%{else}%
										size 0.275 0.15 0.0125
									%{end}%
								size 0.275 0.15 0.0125
								}
							}
						]
					}
				%{end}%
				%{if fields.rightWall.value == true or fields.halfWallOut.value[2] > 0 then}%
					DEF RIGHTWALL Transform {
						%{if fields.halfWallOut.value[2] == 1 then}%
							translation 0.14375 0 0.071875
						%{elseif fields.halfWallOut.value[2] == 2 then}%
							translation 0.14375 0 -0.071875
						%{else}%
							translation 0.14375 0 0
						%{end}%
						children [
							Shape {
								appearance Appearance {
									material Material {
										diffuseColor 0.2 0.47 0.52
									}
								}
								geometry DEF BACKWALLBOX Box {
									%{if fields.halfWallOut.value[2] > 0 then}%
										size 0.0125 0.15 0.1375
									%{else}%
										size 0.0125 0.15 0.275
									%{end}%
								}
							}
						]
					}
				%{end}%
				%{if fields.bottomWall.value == true or fields.halfWallOut.value[3] > 0 then}%
					DEF FRONTWALL Transform {
						%{if fields.halfWallOut.value[3] == 1 then}%
							translation -0.071875 0 0.14375
						%{elseif fields.halfWallOut.value[3] == 2 then}%
							translation 0.071875 0 0.14375
						%{else}%
							translation 0 0 0.14375
						%{end}%
						children [
							Shape {
								appearance Appearance {
									material Material {
										diffuseColor 0.2 0.47 0.52
									}
								}
								geometry DEF BACKWALLBOX Box {
									%{if fields.halfWallOut.value[3] > 0 then}%
										size 0.1375 0.15 0.0125
									%{else}%
										size 0.275 0.15 0.0125
									%{end}%
								}
							}
						]
					}
				%{end}%
				%{if fields.leftWall.value == true or fields.halfWallOut.value[4] > 0 then}%
					DEF LEFTWALL Transform {
						%{if fields.halfWallOut.value[4] == 1 then}%
							translation -0.14375 0 0.071875
						%{elseif fields.halfWallOut.value[4] == 2 then}%
							translation 0.14375 0 0.071875
						%{else}%
							translation -0.14375 0 0
						%{end}%
						children [
							Shape {
								appearance Appearance {
									material Material {
										diffuseColor 0.2 0.47 0.52
									}
								}
								geometry DEF BACKWALLBOX Box {
									%{if fields.halfWallOut.value[4] > 0 then}%
										size 0.0125 0.15 0.1375
									%{else}%
										size 0.0125 0.15 0.275
									%{end}%
								}
							}
						]
					}
				%{end}%
				%{if fields.topExternal.value == true then}%
					Transform {
						translation 0 -0.01 -0.15625
						children [
								Shape {
									appearance Appearance {
										material Material {
											diffuseColor 0.2 0.466667 0.521569
										}
									}
								geometry DEF BACKWALLBOX Box {
									size 0.3 0.17 0.0125
								}
								}
							]
					}
				%{end}%
				%{if fields.rightExternal.value == true then}%
					Transform {
						translation 0.15625 -0.01 0
						rotation 0 1 0 -1.570796
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
									geometry DEF BACKWALLBOX Box {
										size 0.3 0.17 0.0125
									}
									}
								]
						}
				%{end}%
				%{if fields.bottomExternal.value == true then}%
					Transform {
						translation 0 -0.01 0.15625
						rotation 0 1 0 3.141593
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
									geometry DEF BACKWALLBOX Box {
										size 0.3 0.17 0.0125
									}
									}
								]
							}
				%{end}%
				%{if fields.leftExternal.value == true then}%
					Transform {
						translation -0.15625 -0.01 0
						rotation 0 1 0 1.570796
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
									geometry DEF BACKWALLBOX Box {
										size 0.3 0.17 0.0125
									}
									}
								]
					}
				%{end}%
				%{if fields.topLeftCorner.value == true or ((fields.topWall.value == true or fields.leftWall.value == true) and (fields.floor.value == true or fields.trap.value == true)) then}%
					Transform {
							translation -0.14375 0 -0.14375
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.15 0.0125
										}
									}
								]
							}
				%{end}%
				%{if fields.topRightCorner.value == true or ((fields.topWall.value == true or fields.rightWall.value == true) and (fields.floor.value == true or fields.trap.value == true)) then}%
					Transform {
						translation 0.14375 0 -0.14375
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.15 0.0125
										}
									}
								]
							}
				%{end}%
				%{if fields.bottomLeftCorner.value == true or ((fields.bottomWall.value == true or fields.leftWall.value == true) and (fields.floor.value == true or fields.trap.value == true)) then}%
					Transform{
						translation -0.14375 0 0.14375
						children[
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.15 0.0125
										}
									}
								]
							}
				%{end}%
				%{if fields.bottomRightCorner.value == true or ((fields.bottomWall.value == true or fields.rightWall.value == true) and (fields.floor.value == true or fields.trap.value == true)) then}%
					Transform {
						translation 0.14375 0 0.14375
						children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.15 0.0125
										}
									}
								]
					}
				%{end}%
				%{if fields.notch.value == "left" then}%
					DEF externalWallNotchLeft Transform {
						rotation 0 1 0 %{=fields.notchRotation.value}%
						translation -0.15625 -0.01 0.14375
						children [
									Shape {
										appearance DEF WALLAPPEARANCE Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.17 0.0125
										}
									}
								]
							}
				%{end}%
				%{if fields.notch.value == "right" then}%
					DEF externalWallNotchRight Transform {
						translation 0.15625 -0.01 0.14375
						rotation 0 1 0 %{=fields.notchRotation.value}%
						children [
									Shape {
										appearance DEF WALLAPPEARANCE Appearance {
											material Material {
												diffuseColor 0.2 0.466667 0.521569
											}
										}
										geometry DEF BACKWALLBOX Box {
											size 0.0125 0.17 0.0125
										}
									}
								]
							}
				%{end}%
				%{if fields.trap.value == true then}%

							DEF FLOOR Transform {
								translation 0 -0.205 0
								children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.3 0.3 0.3
											}
										}
										geometry DEF FLOORBOX Box {
											size 0.3 0.02 0.3
										}
									}
								]
							}
							Transform {
							  translation -2.8549e-07 -0.135 -0.13
							  rotation 0 1 0 -1.5707953071795862
							  children [
								Shape {
								  appearance DEF TRAPAPP Appearance {
									material Material {
									  diffuseColor 0.05 0.05 0.05
									  shininess 0.8
									}
								  }
								  geometry DEF TRAPEDGEBOX Box {
									size 0.04 0.12 0.3
								  }
								}
							  ]
							}
							Transform {
							  translation -2.03924e-08 -0.135 0.13
							  rotation 0 1 0 -1.5707953071795862
							  children [
								Shape {
								  appearance USE TRAPAPP
								  geometry DEF TRAPEDGEBOX Box {
									size 0.04 0.12 0.3
								  }
								}
							  ]
							}
							Transform {
							  translation -0.13 -0.135 2.06647e-15
							  rotation 0 1 0 3.14159
							  children [
								Shape {
								  appearance USE TRAPAPP
								  geometry DEF TRAPEDGEBOX Box {
									size 0.04 0.12 0.3
								  }
								}
							  ]
							}
							Transform {
							  translation 0.13 -0.135 6.89936e-07
							  rotation 0 1 0 3.14159
							  children [
								Shape {
								  appearance USE TRAPAPP
								  geometry DEF TRAPEDGEBOX Box {
									size 0.04 0.12 0.3
								  }
								}
							  ]
							}
				%{end}%
				%{if fields.checkpoint.value == true then}%
					DEF CHECKPOINT Transform {
						translation 0 -0.075 0
								children [
									Shape {
										appearance CorrodedMetal  {
										}
										geometry Box {
											size 0.3 0.001 0.3
										}
									}
								]
					}
				%{end}%
				%{if fields.start.value == true then}%
					DEF START Transform {
						translation 0 -0.075 0
								children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0 0 0
												emissiveColor 0.0313 0.835 0.0313
												shininess 0.8
											}
										}
										geometry Box {
											size 0.3 0.001 0.3
										}
									}
								]
					}
				%{end}%
				%{if fields.swamp.value == true then}%
					DEF START Transform {
						translation 0 -0.075 0
								children [
									Shape {
										appearance Appearance {
											material Material {
												diffuseColor 0.517647 0.392157 0.192157
											}
										}
										geometry Box {
											size 0.3 0.001 0.3
										}
									}
								]
					}
				%{end}%
			  ]
		  }
				%{
					local full = 7
					for i=1, 4 do
						if (fields.curveWall.value[i] > 0) then}%
							DEF CWALL curvedWall {
								pos %{= i}%
								rot %{= fields.curveWall.value[i]}%
							}
						%{end}%
					%{end}%
	        ]
			boundingObject USE TILE_SHAPES_GROUP

      }
}
